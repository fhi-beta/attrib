<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Attributable risk from distributed lag nonlinear models — attrdl • attrib</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Attributable risk from distributed lag nonlinear models — attrdl" />
<meta property="og:description" content="This is a general function that computes attributable risk (attributable numbers or fractions)
from distributed lag nonlinear models." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">attrib</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2019.10.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Attributable risk from distributed lag nonlinear models</h1>
    
    <div class="hidden name"><code>attrdl.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is a general function that computes attributable risk (attributable numbers or fractions)
from distributed lag nonlinear models.</p>
    </div>

    <pre class="usage"><span class='fu'>attrdl</span>(<span class='no'>x</span>, <span class='no'>basis</span>, <span class='no'>cases</span>, <span class='kw'>model</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>coef</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>vcov</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"af"</span>, <span class='kw'>dir</span> <span class='kw'>=</span> <span class='st'>"back"</span>, <span class='kw'>tot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>cen</span>, <span class='kw'>range</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>sim</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>nsim</span> <span class='kw'>=</span> <span class='fl'>5000</span>, <span class='kw'>sub</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>cases</span>))</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An exposure vector OR (only for <code>dir="back"</code>) a matrix of lagged exposures, for which
the attributable risk needs to be computed.</p></td>
    </tr>
    <tr>
      <th>basis</th>
      <td><p>The object of class "crossbasis" used for fitting the model.</p></td>
    </tr>
    <tr>
      <th>cases</th>
      <td><p>The cases vector OR (only for <code>dir="forw"</code>) the matrix of future cases corresponding to <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>The fitted model. You need to provide either this, or arguments <code>coef</code> and <code>vcov</code>.
<em>The model MUST have a log link function.</em></p></td>
    </tr>
    <tr>
      <th>coef</th>
      <td><p>Coefficients for <code>basis</code> IF <code>model</code> is not provided</p></td>
    </tr>
    <tr>
      <th>vcov</th>
      <td><p>Variance-covariance matrix for <code>basis</code> IF <code>model</code> is not provided</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>Either "an" or "af" for attributable number or attributable fraction</p></td>
    </tr>
    <tr>
      <th>dir</th>
      <td><p>Either "back" or "forw" for backward or forward perspectives of attributable risk</p></td>
    </tr>
    <tr>
      <th>tot</th>
      <td><p>If <code>TRUE</code>, the total attributable risk is computed (number or fraction, depending on argument <code>type</code>)</p></td>
    </tr>
    <tr>
      <th>cen</th>
      <td><p>The reference value used as the counterfactual scenario (the comparator)</p></td>
    </tr>
    <tr>
      <th>range</th>
      <td><p>The range of exposure (for which the attributable risk, compared to <code>cen</code>, is
calculated). If <code>NULL</code>, the whole range is used.</p></td>
    </tr>
    <tr>
      <th>sim</th>
      <td><p>Set to <code>TRUE</code> if Monte Carlo simulation samples should be returned.</p></td>
    </tr>
    <tr>
      <th>nsim</th>
      <td><p>Number of simulation samples desired (only for <code>nsim=TRUE</code>).</p></td>
    </tr>
    <tr>
      <th>sub</th>
      <td><p>Subset of <code>cases</code> for which to calculate the attributable risk (as an integer index
vector). Defaults to <code>1:length(cases)</code>. Argument <code>cases</code> should be a vector (not a matrix).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>By default, a numeric scalar representing the total attributable fraction or number.
If sim=TRUE, a vector of the simulated samples with length nsim. If tot=FALSE, a vector with
contributions for all the observations (see Note below). These quantities are defined versus
a counterfactual scenario defined through the argument cen.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Original function and documentation written by Antonio Gasparrini and available
<a href='https://github.com/gasparrini/2014_gasparrini_BMCmrm_Rcodedata'>here</a>.
Slightly amended by Theodore Lytras for use with <a href='https://github.com/thlytras/FluMoDL/blob/50296a36038142a0cf187f4beec47dfb3204dc74/R/attrdl.R'>FluMoDL</a>.</p>
<p>Documentation below copied from the
<a href='https://github.com/gasparrini/2014_gasparrini_BMCmrm_Rcodedata/blob/master/attrdl.pdf'>original source</a>.</p>
<p>This function computes the attributable fraction or number for a specific exposure
scenario and associated cases, given an estimated exposure-lag-response association defined
by a DLNM. Either forward or backward versions of attributable risk measures are available
in this setting. The method is described by Gasparrini and Leone (2014), see references below.
The function works in combination with other functions in the package dlnm, which is assumed
to be available.</p>
<p>The exposure and cases are provided by the arguments x and cases, respectively. The original
cross-basis and fitted model containg it used for estimation are provided by the arguments
basis and model, respectively. Alternatively, the user can provide estimated coefficients and
(co)variance matrix with coef and vcov.</p>
<p>The function works both with time series and non-time series data. In a time series setting,
both x and cases represent a complete series of ordered observations. More generally, the user
can apply this function for any kind of data: in this case x must be a matrix of lagged
exposures when dir="back", and cases must be a matrix of future cases dir="forw". The function
can compute the total attributable risk (if tot=TRUE, the default) or the contribution for each
observation. The argument cen defines the value used as counterfactual scenario.</p>
<p>If sim=TRUE, the function computes samples of the attributable risk measures by simulating from
the assumed normal distribution of the estimated coefficients (only implemented for total
estimates). These samples can be used to defined empirical confidence intervals.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The function handles missing values in both the x and cases objects, excluding incomplete
observations (also due to lagging) accordingly. However, the total attributable number is
rescaled to match the fraction using as denominator the total observed number in cases. This
approach uses the all the available information even in the presence of missing values in x.
All of this under the assumption that the missing mechanism is unrelated with both exposure and
cases values.</p>
<p>The functions can be also used with estimates from DLNMs reduced to the overall cumulative
exposure-response through the function crossreduce in the package dlnm. In this case, the
modified coefficients and (co)variance matrix of the reduced cross-basis in basis must be
passed using the arguments coef and vcov. This option can be useful when the original estimates
from the full cross-basis are not available any more, for example following a meta-analysis.
Given the lag-specific estimates are not available in this case, only the forward version of
attributable risk (dir="forw") can be computed. See Gasparrini and Leone (2014) for further info.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ul>
<li><p>Gasparrini A, Leone M. Attributable risk from distributed lag models.
<a href='https://bmcmedresmethodol.biomedcentral.com/articles/10.1186/1471-2288-14-55'>BMC Med Res Methodol</a> 2014;14:55.</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># load the package</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>FluMoDL</span>)  <span class='co'># package dlnm is automatically loaded</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: dlnm</span></div><div class='output co'>#&gt; <span class='message'>This is dlnm 2.3.9. For details: help(dlnm) and vignette('dlnmOverview').</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: mvmeta</span></div><div class='output co'>#&gt; <span class='message'>This is mvmeta 0.4.11. For an overview type: help('mvmeta-package').</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘FluMoDL’</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from ‘package:attrib’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    attrdl</span></div><div class='input'>
<span class='co'># define the cross-basis and fit the model</span>
<span class='no'>cb</span> <span class='kw'>&lt;-</span> <span class='fu'>crossbasis</span>(<span class='no'>chicagoNMMAPS</span>$<span class='no'>temp</span>, <span class='kw'>lag</span><span class='kw'>=</span><span class='fl'>30</span>, <span class='kw'>argvar</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fun</span><span class='kw'>=</span><span class='st'>"bs"</span>,
   <span class='kw'>knots</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>10</span>,<span class='fl'>3</span>,<span class='fl'>18</span>)), <span class='kw'>arglag</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>knots</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>10</span>)))
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>splines</span>)
<span class='no'>model</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span>(<span class='no'>death</span> ~ <span class='no'>cb</span> + <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span>(<span class='no'>time</span>, <span class='fl'>7</span>*<span class='fl'>14</span>) + <span class='no'>dow</span>,
   <span class='kw'>family</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>quasipoisson</a></span>(), <span class='no'>chicagoNMMAPS</span>)

<span class='co'># global backward attributable risk of temperature (number and fraction)</span>
<span class='fu'><a href='https://rdrr.io/pkg/FluMoDL/man/attrdl.html'>attrdl</a></span>(<span class='no'>chicagoNMMAPS</span>$<span class='no'>temp</span>,<span class='no'>cb</span>,<span class='no'>chicagoNMMAPS</span>$<span class='no'>death</span>,<span class='no'>model</span>,<span class='kw'>type</span><span class='kw'>=</span><span class='st'>"an"</span>,<span class='kw'>cen</span><span class='kw'>=</span><span class='fl'>21</span>)</div><div class='output co'>#&gt; [1] 41627.79</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/FluMoDL/man/attrdl.html'>attrdl</a></span>(<span class='no'>chicagoNMMAPS</span>$<span class='no'>temp</span>,<span class='no'>cb</span>,<span class='no'>chicagoNMMAPS</span>$<span class='no'>death</span>,<span class='no'>model</span>,<span class='kw'>cen</span><span class='kw'>=</span><span class='fl'>21</span>)</div><div class='output co'>#&gt; [1] 0.07052545</div><div class='input'>
<span class='co'># global forward attributable fraction</span>
<span class='fu'><a href='https://rdrr.io/pkg/FluMoDL/man/attrdl.html'>attrdl</a></span>(<span class='no'>chicagoNMMAPS</span>$<span class='no'>temp</span>,<span class='no'>cb</span>,<span class='no'>chicagoNMMAPS</span>$<span class='no'>death</span>,<span class='no'>model</span>,<span class='kw'>dir</span><span class='kw'>=</span><span class='st'>"forw"</span>,<span class='kw'>cen</span><span class='kw'>=</span><span class='fl'>21</span>)</div><div class='output co'>#&gt; [1] 0.06880993</div><div class='input'>
<span class='co'># empirical confidence intervals</span>
<span class='no'>afsim</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/FluMoDL/man/attrdl.html'>attrdl</a></span>(<span class='no'>chicagoNMMAPS</span>$<span class='no'>temp</span>,<span class='no'>cb</span>,<span class='no'>chicagoNMMAPS</span>$<span class='no'>death</span>,<span class='no'>model</span>,<span class='kw'>cen</span><span class='kw'>=</span><span class='fl'>21</span>,
   <span class='kw'>sim</span><span class='kw'>=</span><span class='fl'>TRUE</span>,<span class='kw'>nsim</span><span class='kw'>=</span><span class='fl'>1000</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span>(<span class='no'>afsim</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2.5</span>,<span class='fl'>97.5</span>)/<span class='fl'>100</span>)</div><div class='output co'>#&gt;       2.5%      97.5% 
#&gt; 0.03498423 0.10693145 </div><div class='input'>
<span class='co'># attributable fraction component due to heat and cold</span>
<span class='fu'><a href='https://rdrr.io/pkg/FluMoDL/man/attrdl.html'>attrdl</a></span>(<span class='no'>chicagoNMMAPS</span>$<span class='no'>temp</span>,<span class='no'>cb</span>,<span class='no'>chicagoNMMAPS</span>$<span class='no'>death</span>,<span class='no'>model</span>,<span class='kw'>cen</span><span class='kw'>=</span><span class='fl'>21</span>,<span class='kw'>range</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>21</span>,<span class='fl'>100</span>))</div><div class='output co'>#&gt; [1] 0.002174912</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/FluMoDL/man/attrdl.html'>attrdl</a></span>(<span class='no'>chicagoNMMAPS</span>$<span class='no'>temp</span>,<span class='no'>cb</span>,<span class='no'>chicagoNMMAPS</span>$<span class='no'>death</span>,<span class='no'>model</span>,<span class='kw'>cen</span><span class='kw'>=</span><span class='fl'>21</span>,<span class='kw'>range</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>100</span>,<span class='fl'>21</span>))</div><div class='output co'>#&gt; [1] 0.06836223</div><div class='input'>
<span class='co'># daily attributable deaths in the second month</span>
<span class='fu'><a href='https://rdrr.io/pkg/FluMoDL/man/attrdl.html'>attrdl</a></span>(<span class='no'>chicagoNMMAPS</span>$<span class='no'>temp</span>,<span class='no'>cb</span>,<span class='no'>chicagoNMMAPS</span>$<span class='no'>death</span>,<span class='no'>model</span>,<span class='kw'>type</span><span class='kw'>=</span><span class='st'>"an"</span>,
   <span class='kw'>tot</span><span class='kw'>=</span><span class='fl'>FALSE</span>,<span class='kw'>cen</span><span class='kw'>=</span><span class='fl'>21</span>)[<span class='fl'>31</span>:<span class='fl'>60</span>]</div><div class='output co'>#&gt;  [1] 17.793827 19.068364 18.332966 14.670728 15.808464 15.760747 12.879505
#&gt;  [8] 15.750699 15.462019 13.168172 14.729931 13.876663 13.208615 14.247822
#&gt; [15] 13.253108 13.086315 12.878537 14.031657 14.527315 13.985856 14.502731
#&gt; [22] 13.511373 13.614972 15.449686 12.236027 14.264590 12.058888  9.866916
#&gt; [29] 11.404745 11.321826</div><div class='input'>
# }

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#note">Note</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Original author: Antonio Gasparrini &lt;<a href='mailto:antonio.gasparrini@lshtm.ac.uk'>antonio.gasparrini@lshtm.ac.uk</a>&gt;</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Richard White.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


